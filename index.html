<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Trends Bubble - 글로벌 트렌드 버블</title>
    <link href="https://fonts.googleapis.com/css2?family=Righteous&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0e27;
            --bg-darker: #050816;
            --accent-primary: #00d9ff;
            --accent-secondary: #ff006e;
            --accent-tertiary: #8338ec;
            --accent-positive: #06ffa5;
            --accent-negative: #ff3366;
            --text-primary: #ffffff;
            --text-secondary: #a0aec0;
            --shadow-glow: 0 0 30px rgba(0, 217, 255, 0.3);
        }

        body {
            font-family: 'Space Mono', monospace;
            background: linear-gradient(135deg, var(--bg-darker) 0%, var(--bg-dark) 100%);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(131, 56, 236, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 0, 110, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(0, 217, 255, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 1;
            opacity: 0.4;
        }

        header {
            position: relative;
            z-index: 100;
            padding: 2rem 3rem;
            backdrop-filter: blur(20px);
            background: rgba(10, 14, 39, 0.7);
        }

        .header-content {
            max-width: 100%;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }

        .logo {
            font-family: 'Righteous', cursive;
            font-size: 2rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(0, 217, 255, 0.5);
            animation: glow-pulse 3s ease-in-out infinite;
        }

        @keyframes glow-pulse {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(0, 217, 255, 0.5)); }
            50% { filter: drop-shadow(0 0 20px rgba(0, 217, 255, 0.8)); }
        }

        .controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .btn, select {
            padding: 0.7rem 1.5rem;
            border: none;
            background: rgba(0, 217, 255, 0.1);
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(0, 217, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover, select:hover {
            background: rgba(0, 217, 255, 0.2);
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.4);
            transform: translateY(-2px);
        }

        .btn.active {
            background: var(--accent-primary);
            color: var(--bg-dark);
            box-shadow: var(--shadow-glow);
        }

        select {
            appearance: none;
            padding-right: 2.5rem;
            background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L6 6L11 1' stroke='%2300d9ff' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
        }

        .stats-bar {
            background: rgba(10, 14, 39, 0.5);
            padding: 1rem 3rem;
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 99;
        }

        .stats-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .stat-value {
            color: var(--accent-primary);
            font-weight: 700;
            font-size: 1.1rem;
        }

        .main-container {
            position: relative;
            z-index: 10;
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        .search-box {
            margin-bottom: 2rem;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1.5rem;
            background: rgba(10, 14, 39, 0.7);
            border: none;
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
            font-size: 1rem;
            border-radius: 0;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
        }

        .search-input::placeholder {
            color: var(--text-secondary);
        }

        .bubble-container {
            position: relative;
            width: 100%;
            height: auto;
            min-height: 800px;
            background: #1a1a1a;
            overflow: hidden;
        }

        .treemap-container {
            width: 100%;
            height: 100%;
            min-height: 800px;
            display: flex;
            flex-direction: column;
            gap: 2px;
            background: #0a0a0a;
            padding: 2px;
        }

        .category-section {
            display: flex;
            gap: 2px;
            flex: 1;
            min-height: 0;
        }

        .treemap-item {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .treemap-item::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .treemap-item:hover {
            filter: brightness(1.3);
            z-index: 10;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .treemap-item:hover::before {
            opacity: 1;
        }

        .treemap-item.positive {
            background-color: var(--item-color);
        }

        .treemap-item.negative {
            background-color: var(--item-color);
        }

        .item-name {
            font-family: 'Space Mono', monospace;
            font-size: 0.95rem;
            font-weight: 700;
            color: #ffffff;
            text-align: center;
            margin-bottom: 0.3rem;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
            line-height: 1.2;
            word-break: break-word;
        }

        .item-stats {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.2rem;
        }

        .item-volume {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
        }

        .item-change {
            font-size: 1.1rem;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
        }

        /* Size variations based on volume */
        .treemap-item.size-xs { flex: 0.5; min-width: 80px; }
        .treemap-item.size-sm { flex: 1; min-width: 100px; }
        .treemap-item.size-md { flex: 2; min-width: 120px; }
        .treemap-item.size-lg { flex: 3; min-width: 150px; }
        .treemap-item.size-xl { flex: 4; min-width: 180px; }

        /* Responsive font sizes */
        .size-xs .item-name { font-size: 0.75rem; }
        .size-sm .item-name { font-size: 0.85rem; }
        .size-md .item-name { font-size: 0.95rem; }
        .size-lg .item-name { font-size: 1.1rem; }
        .size-xl .item-name { font-size: 1.3rem; }

        .size-xs .item-volume { font-size: 0.7rem; }
        .size-sm .item-volume { font-size: 0.75rem; }
        .size-md .item-volume { font-size: 0.85rem; }
        .size-lg .item-volume { font-size: 0.95rem; }
        .size-xl .item-volume { font-size: 1.05rem; }

        .size-xs .item-change { font-size: 0.85rem; }
        .size-sm .item-change { font-size: 0.95rem; }
        .size-md .item-change { font-size: 1.1rem; }
        .size-lg .item-change { font-size: 1.3rem; }
        .size-xl .item-change { font-size: 1.5rem; }

        .info-panel {
            position: fixed;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            width: 350px;
            background: rgba(10, 14, 39, 0.95);
            padding: 2rem;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            z-index: 200;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .info-panel.active {
            opacity: 1;
            pointer-events: all;
        }

        .info-panel h3 {
            font-family: 'Righteous', cursive;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--accent-primary);
        }

        .info-detail {
            display: flex;
            justify-content: space-between;
            padding: 0.7rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .info-value {
            color: var(--text-primary);
            font-weight: 700;
        }

        .google-trends-btn {
            width: 100%;
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--accent-primary);
            color: var(--bg-dark);
            border: none;
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .google-trends-btn:hover {
            background: var(--accent-secondary);
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.4);
        }

        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 30px;
            height: 30px;
            border: none;
            background: rgba(255, 51, 102, 0.2);
            color: var(--accent-negative);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .close-btn:hover {
            background: var(--accent-negative);
            color: white;
            transform: rotate(90deg);
        }

        .search-area {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 2rem;
        }

        .search-input-wrapper {
            flex: 1;
        }

        .legend {
            display: flex;
            gap: 1.5rem;
            align-items: center;
            background: rgba(10, 14, 39, 0.7);
            padding: 1rem 1.5rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 2px;
        }

        .legend-text {
            font-size: 0.8rem;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            header {
                padding: 1.5rem;
            }

            .logo {
                font-size: 1.5rem;
            }

            .controls {
                width: 100%;
                justify-content: center;
            }

            .search-area {
                flex-direction: column;
            }

            .legend {
                flex-wrap: wrap;
                width: 100%;
            }

            .info-panel {
                right: 1rem;
                left: 1rem;
                width: auto;
            }
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(0, 217, 255, 0.2);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 1rem;
            color: var(--accent-primary);
            font-size: 1.2rem;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="noise-overlay"></div>
    
    <header>
        <div class="header-content">
            <div class="logo">◉ GLOBAL TRENDS</div>
            <div class="controls">
                <div class="control-group">
                    <select id="timeframe">
                        <option value="1h">Past Hour</option>
                        <option value="4h">Past 4 Hours</option>
                        <option value="24h" selected>Past 24 Hours</option>
                        <option value="7d">Past 7 Days</option>
                    </select>
                </div>
                <div class="control-group">
                    <select id="category">
                        <option value="all">All Categories</option>
                        <option value="tech">Technology</option>
                        <option value="entertainment">Entertainment</option>
                        <option value="sports">Sports</option>
                        <option value="politics">Politics</option>
                        <option value="business">Business</option>
                    </select>
                </div>
                <button class="btn active" id="bubbleView">Bubble View</button>
                <button class="btn" id="resetView">Reset</button>
            </div>
        </div>
    </header>

    <div class="stats-bar">
        <div class="stats-content">
            <div class="stat-item">
                <span class="stat-label">Trending Topics:</span>
                <span class="stat-value" id="totalTrends">100</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Updated:</span>
                <span class="stat-value" id="updateTime">Just now</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Most Searched:</span>
                <span class="stat-value" id="topTrend">Loading...</span>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="search-area">
            <div class="search-input-wrapper">
                <input type="text" class="search-input" id="searchInput" placeholder="Search trends... (e.g., AI, Taylor Swift, Bitcoin)">
            </div>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #00d9ff;"></div>
                    <div class="legend-text">Technology</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ff006e;"></div>
                    <div class="legend-text">Entertainment</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #8338ec;"></div>
                    <div class="legend-text">Sports</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #06ffa5;"></div>
                    <div class="legend-text">Politics</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ffd60a;"></div>
                    <div class="legend-text">Business</div>
                </div>
            </div>
        </div>

        <div class="bubble-container">
            <div class="treemap-container" id="treemapContainer"></div>
        </div>
    </div>

    <div class="info-panel" id="infoPanel">
        <button class="close-btn" id="closePanel">×</button>
        <h3 id="infoTitle">Trend Details</h3>
        <div class="info-detail">
            <span class="info-label">Category:</span>
            <span class="info-value" id="infoCategory">-</span>
        </div>
        <div class="info-detail">
            <span class="info-label">Search Volume:</span>
            <span class="info-value" id="infoVolume">-</span>
        </div>
        <div class="info-detail">
            <span class="info-label">Change:</span>
            <span class="info-value" id="infoChange">-</span>
        </div>
        <div class="info-detail">
            <span class="info-label">Peak Time:</span>
            <span class="info-value" id="infoPeakTime">-</span>
        </div>
        <div class="info-detail">
            <span class="info-label">Region:</span>
            <span class="info-value" id="infoRegion">-</span>
        </div>
        <button class="google-trends-btn" id="googleTrendsBtn">
            View on Google Trends →
        </button>
    </div>

    <script>
        // 샘플 트렌드 데이터 생성
        const generateTrendData = () => {
            const categories = ['tech', 'entertainment', 'sports', 'politics', 'business'];
            const categoryColors = {
                tech: { positive: '#00d9ff', negative: '#0066ff' },
                entertainment: { positive: '#ff006e', negative: '#cc0055' },
                sports: { positive: '#8338ec', negative: '#6610cc' },
                politics: { positive: '#06ffa5', negative: '#00cc77' },
                business: { positive: '#ffd60a', negative: '#ccaa00' }
            };

            const trendNames = [
                // Tech
                'AI Revolution', 'ChatGPT Update', 'iPhone 16', 'Tesla Cybertruck', 'Meta Quest 3',
                'Google Gemini', 'Apple Vision Pro', 'Quantum Computing', 'SpaceX Launch', 'Nvidia Stock',
                'OpenAI', 'Microsoft AI', 'Bitcoin ETF', 'Ethereum 2.0', 'Web3 Gaming',
                'Neural Link', 'Starlink', '5G Networks', 'Robotics', 'Cloud Computing',
                // Entertainment
                'Taylor Swift', 'Oscars 2026', 'Netflix Shows', 'BTS Concert', 'Marvel Movies',
                'Barbie Movie', 'Oppenheimer', 'Dune Part 3', 'Avatar 3', 'Spotify Wrapped',
                'Grammy Awards', 'Eurovision', 'Coachella', 'Squid Game S3', 'Stranger Things',
                'The Weeknd', 'Beyoncé', 'Super Bowl', 'F1 Racing', 'Premier League',
                // Sports
                'NBA Finals', 'World Cup', 'Olympics', 'Messi Transfer', 'Ronaldo Goals',
                'MLB Season', 'NFL Draft', 'Wimbledon', 'Tour de France', 'Champions League',
                'LeBron James', 'Tom Brady', 'Serena Williams', 'Usain Bolt', 'Lewis Hamilton',
                'UFC Fight', 'Boxing Match', 'Cricket World Cup', 'Golf Masters', 'Tennis Open',
                // Politics
                'US Elections', 'Climate Summit', 'G20 Meeting', 'NATO Summit', 'UN Assembly',
                'Trump Rally', 'Biden Speech', 'EU Parliament', 'Brexit News', 'China Taiwan',
                'Middle East', 'Ukraine News', 'Global Economy', 'Fed Interest Rate', 'Inflation Data',
                'Supreme Court', 'Senate Vote', 'Trade Deal', 'Immigration Policy', 'Healthcare Reform',
                // Business
                'Stock Market', 'Apple Earnings', 'Amazon Prime', 'Google Revenue', 'Meta Profit',
                'Oil Prices', 'Gold Market', 'Real Estate', 'Startup Funding', 'IPO Launch',
                'Tesla Sales', 'Microsoft Deal', 'Disney Plus', 'Nike Launch', 'McDonald\'s Menu',
                'Walmart Sale', 'Costco Deals', 'Target Fashion', 'IKEA Opening', 'Starbucks New'
            ];

            return trendNames.slice(0, 100).map((name, i) => {
                const category = categories[Math.floor(i / 20) % categories.length];
                const volume = Math.random() * 900000 + 100000;
                const change = (Math.random() - 0.3) * 200;
                const isPositive = change >= 0;
                
                return {
                    name,
                    category,
                    volume: Math.floor(volume),
                    change: Math.floor(change),
                    color: isPositive ? categoryColors[category].positive : categoryColors[category].negative,
                    isPositive,
                    peakTime: `${Math.floor(Math.random() * 12) + 1}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')} ${Math.random() > 0.5 ? 'AM' : 'PM'}`,
                    region: ['Global', 'US', 'EU', 'Asia', 'Americas'][Math.floor(Math.random() * 5)]
                };
            });
        };

        class TreemapView {
            constructor(container) {
                this.container = container;
                this.trends = [];
                this.allTrends = [];
            }

            setTrends(trends) {
                this.allTrends = trends;
                this.trends = trends;
                this.render();
            }

            getSizeClass(volume, maxVolume) {
                const normalized = volume / maxVolume;
                if (normalized > 0.8) return 'size-xl';
                if (normalized > 0.6) return 'size-lg';
                if (normalized > 0.4) return 'size-md';
                if (normalized > 0.2) return 'size-sm';
                return 'size-xs';
            }

            getColorIntensity(change) {
                // Calculate color intensity based on change percentage
                const absChange = Math.abs(change);
                const maxChange = 100;
                const intensity = Math.min(absChange / maxChange, 1);
                return intensity;
            }

            adjustColor(color, intensity) {
                // Adjust color brightness based on intensity
                const r = parseInt(color.slice(1, 3), 16);
                const g = parseInt(color.slice(3, 5), 16);
                const b = parseInt(color.slice(5, 7), 16);
                
                const factor = 0.3 + (intensity * 0.7); // Range from 0.3 to 1.0
                
                const newR = Math.floor(r * factor);
                const newG = Math.floor(g * factor);
                const newB = Math.floor(b * factor);
                
                return `rgb(${newR}, ${newG}, ${newB})`;
            }

            render() {
                this.container.innerHTML = '';
                
                if (this.trends.length === 0) {
                    this.container.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--text-secondary);">No trends found</div>';
                    return;
                }

                const maxVolume = Math.max(...this.trends.map(t => t.volume));

                // Group by category
                const categories = ['tech', 'entertainment', 'sports', 'politics', 'business'];
                const categoryLabels = {
                    tech: 'Technology',
                    entertainment: 'Entertainment',
                    sports: 'Sports',
                    politics: 'Politics',
                    business: 'Business'
                };

                categories.forEach(category => {
                    const categoryTrends = this.trends.filter(t => t.category === category);
                    if (categoryTrends.length === 0) return;

                    // Sort by volume
                    categoryTrends.sort((a, b) => b.volume - a.volume);

                    const section = document.createElement('div');
                    section.className = 'category-section';

                    categoryTrends.forEach(trend => {
                        const item = document.createElement('div');
                        const sizeClass = this.getSizeClass(trend.volume, maxVolume);
                        const intensity = this.getColorIntensity(trend.change);
                        const adjustedColor = this.adjustColor(trend.color, intensity);
                        
                        item.className = `treemap-item ${sizeClass} ${trend.isPositive ? 'positive' : 'negative'}`;
                        item.style.setProperty('--item-color', adjustedColor);
                        item.style.backgroundColor = adjustedColor;
                        
                        item.innerHTML = `
                            <div class="item-name">${trend.name}</div>
                            <div class="item-stats">
                                <div class="item-volume">${(trend.volume / 1000).toFixed(0)}K</div>
                                <div class="item-change">${trend.change >= 0 ? '+' : ''}${trend.change}%</div>
                            </div>
                        `;

                        item.addEventListener('click', () => {
                            this.showInfo(trend);
                        });

                        section.appendChild(item);
                    });

                    this.container.appendChild(section);
                });
            }

            showInfo(trend) {
                const panel = document.getElementById('infoPanel');
                panel.classList.add('active');
                
                document.getElementById('infoTitle').textContent = trend.name;
                document.getElementById('infoCategory').textContent = trend.category.toUpperCase();
                document.getElementById('infoVolume').textContent = trend.volume.toLocaleString();
                document.getElementById('infoChange').textContent = 
                    (trend.change >= 0 ? '+' : '') + trend.change + '%';
                document.getElementById('infoChange').style.color = 
                    trend.change >= 0 ? '#06ffa5' : '#ff3366';
                document.getElementById('infoPeakTime').textContent = trend.peakTime;
                document.getElementById('infoRegion').textContent = trend.region;

                // Set Google Trends link
                const googleTrendsBtn = document.getElementById('googleTrendsBtn');
                googleTrendsBtn.onclick = () => {
                    const encodedQuery = encodeURIComponent(trend.name);
                    window.open(`https://trends.google.com/trends/explore?q=${encodedQuery}`, '_blank');
                };
            }

            filterByCategory(category) {
                if (category === 'all') {
                    this.trends = this.allTrends;
                } else {
                    this.trends = this.allTrends.filter(t => t.category === category);
                }
                this.render();
            }

            filterBySearch(query) {
                if (!query) {
                    this.trends = this.allTrends;
                } else {
                    this.trends = this.allTrends.filter(t => 
                        t.name.toLowerCase().includes(query.toLowerCase())
                    );
                }
                this.render();
            }
        }

        // Initialize
        const container = document.getElementById('treemapContainer');
        const treemapView = new TreemapView(container);
        const trends = generateTrendData();
        treemapView.setTrends(trends);

        // Update stats
        document.getElementById('totalTrends').textContent = trends.length;
        document.getElementById('topTrend').textContent = trends[0].name;

        // Update time
        setInterval(() => {
            const now = new Date();
            document.getElementById('updateTime').textContent = now.toLocaleTimeString();
        }, 1000);

        // Event handlers
        document.getElementById('closePanel').addEventListener('click', () => {
            document.getElementById('infoPanel').classList.remove('active');
        });

        document.getElementById('category').addEventListener('change', (e) => {
            treemapView.filterByCategory(e.target.value);
            document.getElementById('totalTrends').textContent = treemapView.trends.length;
        });

        document.getElementById('searchInput').addEventListener('input', (e) => {
            treemapView.filterBySearch(e.target.value);
            document.getElementById('totalTrends').textContent = treemapView.trends.length;
        });

        document.getElementById('resetView').addEventListener('click', () => {
            const newTrends = generateTrendData();
            treemapView.setTrends(newTrends);
            document.getElementById('searchInput').value = '';
            document.getElementById('category').value = 'all';
            document.getElementById('totalTrends').textContent = newTrends.length;
            document.getElementById('topTrend').textContent = newTrends[0].name;
        });

        document.getElementById('timeframe').addEventListener('change', (e) => {
            const newTrends = generateTrendData();
            treemapView.setTrends(newTrends);
            document.getElementById('totalTrends').textContent = newTrends.length;
            document.getElementById('topTrend').textContent = newTrends[0].name;
        });
    </script>
</body>
</html>